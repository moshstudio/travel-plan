import{w as ce,d as me,r as N,f as h,ag as c,ah as m,a as O,am as P,ai as n,aj as _,ak as o,_ as z,$ as B,an as w,ao as k,au as V,X as M,aq as fe}from"./index-BiKhJLtw.js";import{a as De}from"./index-DDfeNcoh.js";import{t as f,e as $,n as U,g as q,f as F,s as ve}from"./format-BUPkFkKG.js";import{b as ge,c as A}from"./function-call-DLt957BV.js";import{P as xe}from"./mount-component-JK79YKnU.js";import{I as Te}from"./index-DO5CgbIM.js";ce(ge);function W(r,s,e){const a=f(r,e==null?void 0:e.in);return isNaN(s)?$(r,NaN):(s&&a.setDate(a.getDate()+s),a)}function L(r,s,e){const a=f(r,e==null?void 0:e.in);if(isNaN(s))return $(r,NaN);if(!s)return a;const d=a.getDate(),u=$(r,a.getTime());u.setMonth(a.getMonth()+s+1,0);const x=u.getDate();return d>=x?u:(a.setFullYear(u.getFullYear(),u.getMonth(),d),a)}function S(r,s,e){const[a,d]=U(e==null?void 0:e.in,r,s);return+q(a)==+q(d)}function ye(r,s){const e=f(r,s==null?void 0:s.in),a=e.getMonth();return e.setFullYear(e.getFullYear(),a+1,0),e.setHours(23,59,59,999),e}function he(r,s){const e=f(r,s==null?void 0:s.in);return e.setDate(1),e.setHours(0,0,0,0),e}function be(r,s){const e=s==null?void 0:s.weekStartsOn,a=f(r,s==null?void 0:s.in),d=a.getDay(),u=(d<e?-7:0)+6-(d-e);return a.setDate(a.getDate()+u),a.setHours(23,59,59,999),a}function _e(r,s){return f(r,s==null?void 0:s.in).getHours()}function we(r,s){return f(r,s==null?void 0:s.in).getMinutes()}function ke(r,s){return+f(r)>+f(s)}function Q(r,s,e){const[a,d]=U(e==null?void 0:e.in,r,s);return a.getFullYear()===d.getFullYear()&&a.getMonth()===d.getMonth()}function Me(r,s,e){const a=+f(r,e==null?void 0:e.in),[d,u]=[+f(s.start,e==null?void 0:e.in),+f(s.end,e==null?void 0:e.in)].sort((x,D)=>x-D);return a>=d&&a<=u}function p(r,s,e){const a=f(r,e==null?void 0:e.in);return a.setHours(s),a}function C(r,s,e){const a=f(r,e==null?void 0:e.in);return a.setMinutes(s),a}const Se={class:"flex flex-col items-end"},pe={class:"flex items-baseline space-x-1"},Ce={class:"flex items-baseline"},Ne={class:"text-base font-semibold text-gray-800"},Oe={key:0,class:"ml-1 text-sm text-gray-500"},Fe={class:"flex items-baseline"},$e={class:"text-base font-semibold text-gray-800"},Re={key:0,class:"ml-1 text-sm text-gray-500"},je={class:"h-full flex flex-col"},Ye={class:"flex-1 overflow-hidden"},He={class:"h-full overflow-y-auto p-3"},Ie={class:"flex justify-between items-center mb-3"},Ee={class:"font-medium text-sm text-gray-900"},Pe={class:"flex space-x-2 mb-3 overflow-x-auto pb-1"},ze=["onClick"],Be={class:"mb-3"},Ve={class:"grid grid-cols-7 gap-1 text-center"},qe=["onClick"],Ae={class:"flex flex-col space-y-2 p-2 bg-gray-50 rounded-lg"},We={class:"flex justify-between"},Le={class:"text-center"},Qe={class:"text-sm font-medium text-blue-500"},Ue={class:"text-center"},Xe={class:"text-sm font-medium text-blue-500"},Ge={key:0,class:"flex justify-between"},Je={class:"text-center"},Ke={class:"text-sm font-medium text-blue-500"},Ze={class:"text-center"},et={class:"text-sm font-medium text-blue-500"},tt={class:"h-full overflow-y-auto p-3"},at={class:"mb-4"},st={class:"grid grid-cols-4 gap-1.5"},nt=["onClick"],lt={class:"grid grid-cols-4 gap-1.5"},rt=["onClick"],it={key:0,class:"p-2 border-t border-gray-100 flex justify-center"},dt=me({__name:"DateTimeRangePicker",props:{timeSelectable:{type:Boolean,default:!0},startDateTime:{default:null},endDateTime:{default:null}},emits:["update:startDateTime","update:endDateTime","change"],setup(r,{emit:s}){const e=r,a=s,d=N(!1),u=N(!1),x=N(null),D=N(new Date),X=["日","一","二","三","四","五","六"],R=[{label:"今天",days:0},{label:"近7天",days:6},{label:"近30天",days:29}],j=Array.from({length:24},(t,l)=>`${l.toString().padStart(2,"0")}:00`),G=h(()=>F(D.value,"yyyy年MM月")),J=h(()=>{const t=he(D.value),l=ye(D.value),v=ve(t,{weekStartsOn:0}),T=be(l,{weekStartsOn:0}),g=[];let i=v;for(;i<=T;)g.push(new Date(i)),i=W(i,1);return g}),K=h(()=>!e.startDateTime||!e.endDateTime?"请选择":""),Z=h(()=>e.startDateTime?F(e.startDateTime,"MM/dd"):"--"),ee=h(()=>e.endDateTime?F(e.endDateTime,"MM/dd"):"--"),Y=h(()=>e.timeSelectable&&e.startDateTime?b(e.startDateTime):""),H=h(()=>e.timeSelectable&&e.endDateTime?b(e.endDateTime):""),I=t=>F(t,"MM/dd"),b=t=>`${_e(t).toString().padStart(2,"0")}:${we(t).toString().padStart(2,"0")}`,te=()=>D.value=L(D.value,-1),ae=()=>D.value=L(D.value,1),se=t=>{x.value=t;const l=new Date,v=R[t].days,T=new Date(l),g=new Date(W(l,v));e.timeSelectable?(a("update:startDateTime",p(C(T,0),0)),a("update:endDateTime",p(C(g,59),23))):(a("update:startDateTime",T),a("update:endDateTime",g)),D.value=new Date(l.getFullYear(),l.getMonth(),1)},ne=t=>{if(Q(t,D.value)||(D.value=new Date(t.getFullYear(),t.getMonth(),1)),!e.startDateTime||e.startDateTime&&e.endDateTime){const l=new Date(t);a("update:startDateTime",e.timeSelectable?p(C(l,0),0):l),a("update:endDateTime",null),x.value=null}else e.startDateTime&&t<e.startDateTime?(a("update:endDateTime",new Date(e.startDateTime)),a("update:startDateTime",new Date(t)),x.value=null):(a("update:endDateTime",new Date(t)),x.value=null)},E=(t,l)=>{const[v,T]=l.split(":").map(Number);if(t==="start"&&e.startDateTime){const g=new Date(e.startDateTime);a("update:startDateTime",p(C(g,T),v))}else if(t==="end"&&e.endDateTime){const g=new Date(e.endDateTime);a("update:endDateTime",p(C(g,T),v))}},le=t=>!e.startDateTime||!e.endDateTime?!1:Me(t,{start:e.startDateTime,end:e.endDateTime}),re=t=>e.startDateTime?S(t,e.startDateTime):!1,ie=t=>e.endDateTime?S(t,e.endDateTime):!1,de=t=>{const l=new Date;if(!Q(t,D.value))return"text-gray-300";const v=[];return S(t,l)&&v.push("border border-blue-500"),(e.startDateTime&&S(t,e.startDateTime)||e.endDateTime&&S(t,e.endDateTime))&&v.push("bg-blue-500 text-white"),v.length?v.join(" "):"text-gray-800"},ue=()=>{if(!e.startDateTime||!e.endDateTime){A({message:"请选择日期范围",position:"bottom"});return}if(ke(e.startDateTime,e.endDateTime)){A({message:"结束时间不能早于开始时间",position:"bottom"});return}a("change",{startDateTime:e.startDateTime,endDateTime:e.endDateTime}),d.value=!1};return(t,l)=>{const v=De,T=Te,g=xe;return m(),c("div",null,[O(v,{center:"",title:"时间范围",value:K.value,border:!1,"is-link":"",onClick:l[0]||(l[0]=i=>d.value=!0)},{value:P(()=>[n("div",Se,[n("div",pe,[n("div",Ce,[n("span",Ne,o(Z.value),1),Y.value?(m(),c("span",Oe,o(Y.value),1)):_("",!0)]),l[3]||(l[3]=n("span",{class:"text-sm text-gray-400"},"—",-1)),n("div",Fe,[n("span",$e,o(ee.value),1),H.value?(m(),c("span",Re,o(H.value),1)):_("",!0)])])])]),_:1},8,["value"]),O(g,{show:d.value,"onUpdate:show":l[2]||(l[2]=i=>d.value=i),position:"bottom",round:"",style:{height:"70%"}},{default:P(()=>[n("div",je,[n("div",{class:"flex justify-between items-center p-3 border-b border-gray-100"},[l[4]||(l[4]=n("h3",{class:"font-medium text-gray-900 text-sm"},"选择时间范围",-1)),n("span",{class:"text-blue-500 font-medium text-sm cursor-pointer select-none",onClick:ue}," 确定 ")]),n("div",Ye,[z(n("div",He,[n("div",Ie,[O(T,{name:"arrow-left",size:"14",onClick:te}),n("span",Ee,o(G.value),1),O(T,{name:"arrow",size:"14",onClick:ae})]),n("div",Pe,[(m(),c(w,null,k(R,(i,y)=>n("button",{key:y,class:M(["flex-shrink-0 px-2.5 py-1 text-xs rounded-full border",{"bg-blue-500 text-white border-blue-500":x.value===y,"border-gray-200 text-gray-700":x.value!==y}]),onClick:oe=>se(y)},o(i.label),11,ze)),64))]),n("div",Be,[n("div",Ve,[(m(),c(w,null,k(X,i=>n("div",{key:i,class:"text-xs text-gray-500 py-1"},o(i),1)),64)),(m(!0),c(w,null,k(J.value,(i,y)=>(m(),c("div",{key:y,class:"py-0.5 relative",onClick:oe=>ne(i)},[le(i)?(m(),c("div",{key:0,class:M(["absolute inset-0 bg-blue-100/50",{"rounded-l-full":re(i),"rounded-r-full":ie(i)}])},null,2)):_("",!0),n("div",{class:M(["w-7 h-7 mx-auto flex items-center justify-center rounded-full text-xs relative z-10",de(i)])},o(i.getDate()),3)],8,qe))),128))])]),n("div",Ae,[n("div",We,[n("div",Le,[l[5]||(l[5]=n("div",{class:"text-xs text-gray-500"},"开始日期",-1)),n("div",Qe,o(t.startDateTime?I(t.startDateTime):"--"),1)]),n("div",Ue,[l[6]||(l[6]=n("div",{class:"text-xs text-gray-500"},"结束日期",-1)),n("div",Xe,o(t.endDateTime?I(t.endDateTime):"--"),1)])]),t.timeSelectable?(m(),c("div",Ge,[n("div",Je,[l[7]||(l[7]=n("div",{class:"text-xs text-gray-500"},"开始时间",-1)),n("div",Ke,o(t.startDateTime?b(t.startDateTime):"--"),1)]),n("div",Ze,[l[8]||(l[8]=n("div",{class:"text-xs text-gray-500"},"结束时间",-1)),n("div",et,o(t.endDateTime?b(t.endDateTime):"--"),1)])])):_("",!0)])],512),[[B,!u.value]]),z(n("div",tt,[n("div",at,[l[9]||(l[9]=n("div",{class:"text-sm font-medium text-gray-900 mb-1"},"开始时间",-1)),n("div",st,[(m(!0),c(w,null,k(V(j),i=>(m(),c("button",{key:"start-"+i,class:M(["py-1.5 rounded text-xs",t.startDateTime&&b(t.startDateTime)===i?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"]),onClick:y=>E("start",i)},o(i),11,nt))),128))])]),n("div",null,[l[10]||(l[10]=n("div",{class:"text-sm font-medium text-gray-900 mb-1"},"结束时间",-1)),n("div",lt,[(m(!0),c(w,null,k(V(j),i=>(m(),c("button",{key:"end-"+i,class:M(["py-1.5 rounded text-xs",t.endDateTime&&b(t.endDateTime)===i?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"]),onClick:y=>E("end",i)},o(i),11,rt))),128))])])],512),[[B,u.value]])]),t.timeSelectable?(m(),c("div",it,[n("button",{class:"px-4 py-1.5 bg-blue-500 text-white rounded-full text-xs",onClick:l[1]||(l[1]=i=>u.value=!u.value)},o(u.value?"选择日期":"选择时间"),1)])):_("",!0)])]),_:1},8,["show"])])}}}),vt=fe(dt,[["__scopeId","data-v-2ef06a9a"]]);export{vt as D};
