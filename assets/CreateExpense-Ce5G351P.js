import{d as E,ae as F,y as $,r as S,L as q,ag as f,a as n,ai as u,am as s,ah as x,au as _,an as T,ao as h,al as z,aN as R,ap as g,aC as j,ak as V,af as A,aD as p,aq as G}from"./index-BiKhJLtw.js";import{C as Y}from"./index-CTyQ4ZiN.js";import{C as H,F as J,a as K}from"./index-DDfeNcoh.js";import{d as Q,N as W}from"./index-DO5CgbIM.js";import{I as X,C as Z}from"./iconify-DmLVIXI8.js";import{g as ee,b as te}from"./tdt-D07NOdeQ.js";import{B as ae,P as ne}from"./mount-component-JK79YKnU.js";import{s as b,a as oe}from"./function-call-DLt957BV.js";const se={class:"w-screen h-screen flex flex-col bg-[var(--van-background)]"},le={class:"flex-grow w-full p-4 overflow-auto"},re={class:"p-2 flex flex-wrap gap-2"},ie={class:"mt-6 p-2"},de=E({__name:"CreateExpense",setup(ue){const l=Q(),{currentTravel:k}=F(l),t=$({amount:0,currency:"CNY",description:"",dateTime:new Date().toISOString(),paymentMethod:"alipay",tags:[]}),d=S(!1),I=[1,2,5,8,10,20,50,100],y=[{text:"支付宝",value:"alipay"},{text:"微信支付",value:"wechat_pay"},{text:"现金",value:"cash"},{text:"信用卡",value:"credit_card"},{text:"银行转账",value:"bank_transfer"},{text:"其他",value:"other"}],i=S(!1),M=async()=>{if(!t.amount){b("请输入有效金额");return}if(!l.expenseSelectAddress){b("请选择位置");return}if(!k.value){b("请先创建旅行"),A.push({name:"CreateTravel"});return}const r=new Date;console.log("cahungjian expense",p(l.expenseSelectAddress));const e={travelId:k.value.travelId,amount:Number(t.amount),currency:t.currency,description:t.description,dateTime:new Date(t.dateTime).getTime(),paymentMethod:t.paymentMethod,tags:p(t.tags),isReimbursed:!1,location:p(l.expenseSelectAddress),createdAt:r.toISOString(),updatedAt:r.toISOString()};await l.addTravelExpense(p(e)),oe("花费记录添加成功"),l.expenseSelectAddress=void 0,D(),w()},D=()=>{t.amount=0,t.description="",t.dateTime=new Date().toISOString()},w=()=>{A.back()},N=["餐饮","交通","住宿","门票","购物","娱乐","其他"];return q(async()=>{if(t.dateTime=new Date().toISOString(),!l.expenseSelectAddress){const r=await ee();if(r){const e=await te(r);l.expenseSelectAddress={name:e,coordinates:{lng:r.lng,lat:r.lat}}}}}),(r,e)=>{const L=W,m=J,C=ae,c=H,v=K,P=Y,U=Z,B=j,O=ne;return x(),f("div",se,[n(L,{title:"创建记录花费","left-arrow":"",onClickLeft:w}),u("div",le,[n(c,{inset:"",class:"mb-4"},{default:s(()=>[n(m,{"model-value":t.amount,"onUpdate:modelValue":e[0]||(e[0]=a=>t.amount=a),label:"金额",type:"number",placeholder:"0.00",required:"",clearable:"",class:"text-2xl font-bold"},{"right-icon":s(()=>[n(_(X),{icon:"mingcute:currency-cny-2-fill",width:"18",height:"18"})]),_:1},8,["model-value"]),u("div",re,[(x(),f(T,null,h(I,a=>n(C,{key:a,size:"small",plain:"",type:"primary",onClick:o=>t.amount=a},{default:s(()=>[g(V(a),1)]),_:2},1032,["onClick"])),64))])]),_:1}),n(c,{inset:"",class:"mb-4"},{default:s(()=>{var a;return[n(v,{center:"","is-link":"",title:"支付方式",value:(a=y.find(o=>o.value===t.paymentMethod))==null?void 0:a.text,onClick:e[1]||(e[1]=o=>i.value=!0)},null,8,["value"]),n(v,{center:"","is-link":"",title:"时间",onClick:e[5]||(e[5]=o=>d.value=!d.value),class:"datetime-cell"},{value:s(()=>[u("div",{onClick:e[4]||(e[4]=z(()=>{},["stop"])),class:"flex items-center justify-end"},[n(_(R),{modelValue:t.dateTime,"onUpdate:modelValue":e[2]||(e[2]=o=>t.dateTime=o),"is-open":d.value,"onUpdate:isOpen":e[3]||(e[3]=o=>d.value=o),type:"datetime",class:"max-w-[160px]"},null,8,["modelValue","is-open"])])]),_:1})]}),_:1}),n(c,{inset:"",class:"mb-4"},{default:s(()=>{var a;return[n(v,{title:"位置",value:((a=_(l).expenseSelectAddress)==null?void 0:a.name)||"",clickable:"","is-link":"",onClick:e[6]||(e[6]=()=>r.$router.push({name:"ExpensePosition"}))},null,8,["value"]),n(m,{modelValue:t.description,"onUpdate:modelValue":e[7]||(e[7]=o=>t.description=o),label:"描述",placeholder:"可选：输入消费描述",clearable:""},null,8,["modelValue"]),n(m,{name:"tags",label:"分类"},{input:s(()=>[n(U,{modelValue:t.tags,"onUpdate:modelValue":e[8]||(e[8]=o=>t.tags=o),direction:"horizontal"},{default:s(()=>[(x(),f(T,null,h(N,o=>n(P,{key:o,name:o,shape:"square",class:"mr-2 mb-2"},{default:s(()=>[g(V(o),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]}),_:1}),u("div",ie,[n(C,{round:"",block:"",type:"primary",size:"large",onClick:M,disabled:!t.amount},{default:s(()=>e[13]||(e[13]=[g(" 记录花费 ")])),_:1,__:[13]},8,["disabled"])])]),n(O,{show:i.value,"onUpdate:show":e[12]||(e[12]=a=>i.value=a),position:"bottom",round:""},{default:s(()=>[n(B,{value:t.paymentMethod,"onUpdate:value":e[9]||(e[9]=a=>t.paymentMethod=a),columns:y,onConfirm:e[10]||(e[10]=a=>{t.paymentMethod=a.selectedValues[0],i.value=!1}),onCancel:e[11]||(e[11]=a=>i.value=!1)},null,8,["value"])]),_:1},8,["show"])])}}}),be=G(de,[["__scopeId","data-v-5acd22ba"]]);export{be as default};
