import{b0 as g,b1 as N,b2 as O,az as h,b3 as j,b4 as q,b5 as R,b6 as v,b7 as K}from"./index-d8_m604x.js";const m="Request cancelled";async function x(t,e){const r=e==null?void 0:e.signal;if(r!=null&&r.aborted)throw new Error(m);const o=e==null?void 0:e.maxRedirections,s=e==null?void 0:e.connectTimeout,d=e==null?void 0:e.proxy,n=e==null?void 0:e.danger;e&&(delete e.maxRedirections,delete e.connectTimeout,delete e.proxy,delete e.danger);const a=e!=null&&e.headers?e.headers instanceof Headers?e.headers:new Headers(e.headers):new Headers,c=new Request(t,e),u=await c.arrayBuffer(),p=u.byteLength!==0?Array.from(new Uint8Array(u)):null;for(const[l,i]of c.headers)a.get(l)||a.set(l,i);const y=(a instanceof Headers?Array.from(a.entries()):Array.isArray(a)?a:Object.entries(a)).map(([l,i])=>[l,typeof i=="string"?i:i.toString()]);if(r!=null&&r.aborted)throw new Error(m);const C=await g("plugin:http|fetch",{clientConfig:{method:c.method,url:c.url,headers:y,data:p,maxRedirections:o,connectTimeout:s,proxy:d,danger:n}}),S=()=>g("plugin:http|fetch_cancel",{rid:C});if(r!=null&&r.aborted)throw S(),new Error(m);r==null||r.addEventListener("abort",()=>void S());const{status:U,statusText:W,url:_,headers:E,rid:P}=await g("plugin:http|fetch_send",{rid:C}),T=[101,103,204,205,304].includes(U)?null:new ReadableStream({start:l=>{const i=new N;i.onmessage=b=>{if(r!=null&&r.aborted){l.error(m);return}const f=new Uint8Array(b),k=f[f.byteLength-1],H=f.slice(0,f.byteLength-1);if(k==1){l.close();return}l.enqueue(H)},g("plugin:http|fetch_read_body",{rid:P,streamChannel:i}).catch(b=>{l.error(b)})}}),w=new Response(T,{status:U,statusText:W});return Object.defineProperty(w,"url",{value:_}),Object.defineProperty(w,"headers",{value:new Headers(E)}),w}function L(t){return encodeURIComponent(t).replace(/%7B/g,"{").replace(/%7D/g,"}")}async function V(){return navigator.geolocation?await new Promise((t,e)=>{navigator.geolocation.getCurrentPosition(r=>{t({lng:r.coords.longitude,lat:r.coords.latitude})},r=>{e(r)})}):null}async function z(t){const e=K.replace("{lng}",t.lng.toPrecision()).replace("{lat}",t.lat.toPrecision()),r=h();let o=window.fetch,s;r.isWeb||(o=x,s={headers:{"Access-Control-Allow-Origin":"*",accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36"}});const n=await(await o(e,s)).json();return n.result.formatted_address?n.result.formatted_address:n.result.addressComponent.nation+n.result.addressComponent.address}async function X(){return h().isWeb?q:`http://127.0.0.1:${await R()}/proxy/_/`+L(q)}async function Y(){return h().isWeb?v:`http://127.0.0.1:${await R()}/proxy/_/`+L(v)}async function Z(t){var r;const e=O.replace("{keyword}",t);try{const o=h();let s=window.fetch,d;return o.isWeb||(s=x,d={headers:{"Access-Control-Allow-Origin":"*",accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36"}}),(r=(await(await s(e,d)).json()).suggests)==null?void 0:r.map(c=>{const[u,p]=c.lonlat.split(",");return{name:c.address+" "+c.name,address:c.address,coordinates:{lng:Number(u),lat:Number(p)}}})}catch(o){return console.error("tdtSearch error:",o),[]}}async function B(t,e,r){var s;const o=j.replace("{keyword}",t).replace("{queryRadius}",e).replace("{pointLonlat}",r);try{const d=h();let n=window.fetch,a;return d.isWeb||(n=x,a={headers:{"Access-Control-Allow-Origin":"*",accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","upgrade-insecure-requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36"}}),(s=(await(await n(o,a)).json()).pois)==null?void 0:s.map(p=>{const[A,y]=p.lonlat.split(",");return{name:p.address+" "+p.name,address:p.address,coordinates:{lng:Number(A),lat:Number(y)}}})}catch(d){return console.error("tdtSearch error:",d),[]}}export{Y as a,z as b,Z as c,B as d,V as g,X as t};
