import{aT as oe,a6 as ne,t as y,a3 as D,v as b,I as ae,n as se,l as R,m as le,B as A,aZ as ce,N,r as k,d as $,c as K,C as j,a as i,at as F,ab as H,e as T,A as re,R as M,_ as G,$ as U,a0 as g,w as V,f as ie,g as Y,K as ue,L as de,an as fe,a_ as ve,q as x,F as me,aH as ye,a4 as he,a$ as Ie,y as Ce}from"./index-DOtJjWyZ.js";import{b as E,I as Oe,P as we}from"./index-DGOxOV-o.js";function Pe(e,{args:t=[],done:o,canceled:s,error:n}){if(e){const c=e.apply(null,t);oe(c)?c.then(r=>{r?o():s&&s()}).catch(n||ne):c?o():s&&s()}else o()}const Z={show:Boolean,zIndex:b,overlay:y,duration:b,teleport:[String,Object],lockScroll:y,lazyRender:y,beforeClose:Function,overlayStyle:Object,overlayClass:D,transitionAppear:Boolean,closeOnClickOverlay:y},_e=Object.keys(Z);let I=0;const _="van-overflow-hidden";function be(e,t){const o=ae(),s="01",n="10",c=u=>{o.move(u);const m=o.deltaY.value>0?n:s,S=ce(u.target,e.value),{scrollHeight:h,offsetHeight:O,scrollTop:w}=S;let d="11";w===0?d=O>=h?"00":"01":w+O>=h&&(d="10"),d!=="11"&&o.isVertical()&&!(parseInt(d,2)&parseInt(m,2))&&N(u,!0)},r=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",c,{passive:!1}),I||document.body.classList.add(_),I++},l=()=>{I&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",c),I--,I||document.body.classList.remove(_))},v=()=>t()&&r(),C=()=>t()&&l();se(v),R(C),le(C),A(t,u=>{u?r():l()})}function q(e){const t=k(!1);return A(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const[ke,Se]=K("overlay"),pe={show:Boolean,zIndex:b,duration:b,className:D,lockScroll:y,lazyRender:y,customStyle:Object,teleport:[String,Object]};var xe=$({name:ke,inheritAttrs:!1,props:pe,setup(e,{attrs:t,slots:o}){const s=k(),n=q(()=>e.show||!e.lazyRender),c=l=>{e.lockScroll&&N(l,!0)},r=n(()=>{var l;const v=T(re(e.zIndex),e.customStyle);return M(e.duration)&&(v.animationDuration=`${e.duration}s`),G(i("div",g({ref:s,style:v,class:[Se(),e.className]},t),[(l=o.default)==null?void 0:l.call(o)]),[[U,e.show]])});return j("touchmove",c,{target:s}),()=>{const l=i(F,{name:"van-fade",appear:!0},{default:r});return e.teleport?i(H,{to:e.teleport},{default:()=>[l]}):l}}});const ge=V(xe),Ae=T({},Z,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[Te,L]=K("popup");var ze=$({name:Te,inheritAttrs:!1,props:Ae,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:s}){let n,c;const r=k(),l=k(),v=q(()=>e.show||!e.lazyRender),C=ie(()=>{const a={zIndex:r.value};if(M(e.duration)){const f=e.position==="center"?"animationDuration":"transitionDuration";a[f]=`${e.duration}s`}return a}),u=()=>{n||(n=!0,r.value=e.zIndex!==void 0?+e.zIndex:ve(),t("open"))},m=()=>{n&&Pe(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},S=a=>{t("clickOverlay",a),e.closeOnClickOverlay&&m()},h=()=>{if(e.overlay)return i(ge,g({show:e.show,class:e.overlayClass,zIndex:r.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},E(),{onClick:S}),{default:s["overlay-content"]})},O=a=>{t("clickCloseIcon",a),m()},w=()=>{if(e.closeable)return i(Oe,{role:"button",tabindex:0,name:e.closeIcon,class:[L("close-icon",e.closeIconPosition),ye],classPrefix:e.iconPrefix,onClick:O},null)};let d;const W=()=>{d&&clearTimeout(d),d=setTimeout(()=>{t("opened")})},J=()=>t("closed"),Q=a=>t("keydown",a),X=v(()=>{var a;const{destroyOnClose:f,round:p,position:P,safeAreaInsetTop:ee,safeAreaInsetBottom:te,show:B}=e;if(!(!B&&f))return G(i("div",g({ref:l,style:C.value,role:"dialog",tabindex:0,class:[L({round:p,[P]:P}),{"van-safe-area-top":ee,"van-safe-area-bottom":te}],onKeydown:Q},o,E()),[(a=s.default)==null?void 0:a.call(s),w()]),[[U,B]])}),z=()=>{const{position:a,transition:f,transitionAppear:p}=e,P=a==="center"?"van-fade":`van-popup-slide-${a}`;return i(F,{name:f||P,appear:p,onAfterEnter:W,onAfterLeave:J},{default:X})};return A(()=>e.show,a=>{a&&!n&&(u(),o.tabindex===0&&me(()=>{var f;(f=l.value)==null||f.focus()})),!a&&n&&(n=!1,t("close"))}),Y({popupRef:l}),be(l,()=>e.show&&e.lockScroll),j("popstate",()=>{e.closeOnPopstate&&(m(),c=!1)}),ue(()=>{e.show&&u()}),de(()=>{c&&(t("update:show",!0),c=!1)}),R(()=>{e.show&&e.teleport&&(m(),c=!0)}),he(we,()=>e.show),()=>e.teleport?i(H,{to:e.teleport},{default:()=>[h(),z()]}):i(fe,null,[h(),z()])}});const Le=V(ze);function De(){const e=Ce({show:!1}),t=n=>{e.show=n},o=n=>{T(e,n,{transitionAppear:!0}),t(!0)},s=()=>t(!1);return Y({open:o,close:s,toggle:t}),{open:o,close:s,state:e,toggle:t}}function Re(e){const t=Ie(e),o=document.createElement("div");return document.body.appendChild(o),{instance:t.mount(o),unmount(){t.unmount(),document.body.removeChild(o)}}}export{Le as P,Z as a,Pe as c,Re as m,_e as p,De as u};
