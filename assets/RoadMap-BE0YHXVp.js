import{d as at,ae as lt,B as $,f as ht,r as j,K as dt,ag as ft,a as ut,ai as ct,ah as gt,aq as Ct}from"./index-C9bZNooh.js";import{a as _t,N as vt,_ as yt}from"./index-DdOUakjv.js";import{j as D,k as wt,m as pt,n as At,p as St,q as mt,s as S,v as O,w as Rt,x as Ft,y as Mt,z as et,A as Et,D as Pt,E as st,G as Lt,H as Tt,I as Dt,J as Yt,K as Ot,L as Xt,N as bt,P as q,O as It,Q as kt,R as $t,U as xt,W as zt,Y as N,_ as qt,$ as Vt,a0 as Wt,a1 as jt,a2 as M,a3 as Nt,a4 as Zt,a5 as Bt,S as Y,a6 as Z,a7 as B,M as Gt,V as Ut,T as G,f as x,X as U,a8 as H,a as J,F as L,b as z}from"./XYZ-Bxwk7cz3.js";import{l as Ht,i as it,b as rt,c as Jt,d as Kt,V as K,a as Q,F as tt}from"./Vector-CksEjsxl.js";import{t as Qt,a as te}from"./tdt-Bzbcuz1m.js";class X extends D{constructor(t,e,i){super(),i!==void 0&&e===void 0?this.setFlatCoordinates(i,t):(e=e||0,this.setCenterAndRadius(t,e,i))}clone(){const t=new X(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){const r=this.flatCoordinates,n=t-r[0],o=e-r[1],a=n*n+o*o;if(a<s){if(a===0)for(let l=0;l<this.stride;++l)i[l]=r[l];else{const l=this.getRadius()/Math.sqrt(a);i[0]=r[0]+l*n,i[1]=r[1]+l*o;for(let u=2;u<this.stride;++u)i[u]=r[u]}return i.length=this.stride,a}return s}containsXY(t,e){const i=this.flatCoordinates,s=t-i[0],r=e-i[1];return s*s+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){const e=this.flatCoordinates,i=e[this.stride]-e[0];return wt(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){const e=this.getExtent();if(pt(t,e)){const i=this.getCenter();return t[0]<=i[0]&&t[2]>=i[0]||t[1]<=i[1]&&t[3]>=i[1]?!0:At(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){const e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],s=t.slice();s[e]=s[0]+i;for(let r=1;r<e;++r)s[e+r]=t[r];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(t,e,i){this.setLayout(i,t,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let r=St(s,0,t,this.stride);s[r++]=s[0]+e;for(let n=1,o=this.stride;n<o;++n)s[r++]=s[n];s.length=r,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){const i=this.getCenter(),s=this.getStride();this.setCenter(mt(i,0,i.length,s,t,e,i)),this.changed()}}X.prototype.transform;class A extends D{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){S(this.flatCoordinates,t),this.changed()}clone(){const t=new A(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<O(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Rt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ft(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,s))}forEachSegment(t){return Mt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Ht(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return et(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return it(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return rt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Et(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new A(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=st(this.flatCoordinates,0,t,this.stride),this.changed()}}class T extends D{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{const s=t,r=[],n=[];for(let a=0,l=s.length;a<l;++a){const u=s[a];S(r,u.getFlatCoordinates()),n.push(r.length)}const o=s.length===0?this.getLayout():s[0].getLayout();this.setFlatCoordinates(o,r),this.ends_=n}}appendLineString(t){S(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new T(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,s){return s<O(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Lt(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Tt(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,s))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,Jt(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return Dt(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new A(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,s=[];let r=0;for(let n=0,o=e.length;n<o;++n){const a=e[n],l=new A(t.slice(r,a),i);s.push(l),r=a}return s}getLength(){const t=this.ends_;let e=0,i=0;for(let s=0,r=t.length;s<r;++s)i+=rt(this.flatCoordinates,e,t[s],this.stride),e=t[s];return i}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const s=this.ends_,r=this.stride;for(let n=0,o=s.length;n<o;++n){const a=s[n],l=it(e,i,a,r,.5);S(t,l),i=a}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=Yt(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new T(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Ot(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Xt(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class V extends D{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){S(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){const t=new V(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,s){if(s<O(this.getExtent(),t,e))return s;const r=this.flatCoordinates,n=this.stride;for(let o=0,a=r.length;o<a;o+=n){const l=bt(t,e,r[o],r[o+1]);if(l<s){s=l;for(let u=0;u<n;++u)i[u]=r[o+u];i.length=n}}return s}getCoordinates(){return et(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new q(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,s=[];for(let r=0,n=t.length;r<n;r+=i){const o=new q(t.slice(r,r+i),e);s.push(o)}return s}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let s=0,r=e.length;s<r;s+=i){const n=e[s],o=e[s+1];if(It(t,n,o))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=st(this.flatCoordinates,0,t,this.stride),this.changed()}}class m extends D{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){const s=t,r=[],n=[];for(let o=0,a=s.length;o<a;++o){const l=s[o],u=r.length,d=l.getEnds();for(let g=0,C=d.length;g<C;++g)d[g]+=u;S(r,l.getFlatCoordinates()),n.push(d)}e=s.length===0?this.getLayout():s[0].getLayout(),t=r,i=n}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;S(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let s=0,r=e.length;s<r;++s)e[s]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let s=0;s<t;++s)e[s]=this.endss_[s].slice();const i=new m(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,s){return s<O(this.getExtent(),t,e)?s:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(kt(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),$t(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,s))}containsXY(t,e){return xt(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return zt(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),N(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,qt(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Kt(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Vt(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new V(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Wt(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=N(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=jt(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new m(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const i=this.endss_[t].slice(),s=i[i.length-1];if(e!==0)for(let r=0,n=i.length;r<n;++r)i[r]-=e;return new M(this.flatCoordinates.slice(e,s),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,s=[];let r=0;for(let n=0,o=i.length;n<o;++n){const a=i[n].slice(),l=a[a.length-1];if(r!==0)for(let d=0,g=a.length;d<g;++d)a[d]-=r;const u=new M(e.slice(r,l),t,a);s.push(u),r=l}return s}getType(){return"MultiPolygon"}intersectsExtent(t){return Nt(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Zt(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const s=i[i.length-1];this.flatCoordinates.length=s.length===0?0:s[s.length-1]}this.changed()}}var F=function(h,t){var e=h[0]-t[0],i=h[1]-t[1];return Math.sqrt(e*e+i*i)},nt;(function(){function h(e,i){var s;for(let r=e.length-1;r>0;r--)(e[r][0]>i&&e[r-1][0]<i||e[r][0]<i&&e[r-1][0]>i)&&(s=[i,(i-e[r][0])/(e[r-1][0]-e[r][0])*(e[r-1][1]-e[r][1])+e[r][1]],e.splice(r,0,s))}function t(e,i){var s;for(let r=e.length-1;r>0;r--)(e[r][1]>i&&e[r-1][1]<i||e[r][1]<i&&e[r-1][1]>i)&&(s=[(i-e[r][1])/(e[r-1][1]-e[r][1])*(e[r-1][0]-e[r][0])+e[r][0],i],e.splice(r,0,s))}nt=function(e,i){var s=i.getType()==="Polygon";if(!s&&i.getType()!=="MultiPolygon")return null;var r=i.getCoordinates();return s&&(r=[r]),r.forEach(function(n){n.forEach(function(o){h(o,e[0]),h(o,e[2]),t(o,e[1]),t(o,e[3])})}),r.forEach(function(n){n.forEach(function(o){o.forEach(function(a){a[0]<e[0]?a[0]=e[0]:a[0]>e[2]&&(a[0]=e[2]),a[1]<e[1]?a[1]=e[1]:a[1]>e[3]&&(a[1]=e[3])})})}),s?new M(r[0]):new m(r)}})();var b=function(h,t,e,i){var s=[];i!==!1&&s.push(h);var r=F(h,t);if(r){var n=Math.round(r/e);if(n>1)for(var o=(t[0]-h[0])/n,a=(t[1]-h[1])/n,l=1;l<n;l++)s.push([h[0]+o*l,h[1]+a*l])}return s.push(t),s};A.prototype.sampleAt=function(h){for(var t=this.getCoordinates(),e=[],i=1;i<t.length;i++)e=e.concat(b(t[i-1],t[i],h,i===1));return new A(e)};T.prototype.sampleAt=function(h){var t=this.getCoordinates(),e=[];return t.forEach(function(i){for(var s=[],r=1;r<i.length;r++)s=s.concat(b(i[r-1],i[r],h,r===1));e.push(s)}),new T(e)};M.prototype.sampleAt=function(h){var t=this.getCoordinates(),e=[];return t.forEach(function(i){for(var s=[],r=1;r<i.length;r++)s=s.concat(b(i[r-1],i[r],h,r===1));e.push(s)}),new M(e)};m.prototype.sampleAt=function(h){var t=this.getCoordinates(),e=[];return t.forEach(function(i){var s=[];e.push(s),i.forEach(function(r){for(var n=[],o=1;o<r.length;o++)n=n.concat(b(r[o-1],r[o],h,o===1));s.push(n)})}),new m(e)};X.prototype.intersection=function(h,t){if(h.sampleAt){var e=Bt(this.getCenter().concat(this.getCenter()),this.getRadius());h=nt(e,h),h=h.simplify(t);var i=this.getCenter(),s=this.getRadius(),r=h.sampleAt(t).getCoordinates();switch(h.getType()){case"Polygon":r=[r];case"MultiPolygon":{var n=!1,o=[];return r.forEach(function(a){var l=[];o.push(l),a.forEach(function(u){var d=[];l.push(d),u.forEach(function(g){var C=F(i,g);C>s?(n=!0,d.push([i[0]+s/C*(g[0]-i[0]),i[1]+s/C*(g[1]-i[1])])):d.push(g)})})}),n?h.getType()==="Polygon"?new M(o[0]):new m(o):h}}}else console.warn("[ol/geom/Circle~intersection] Unsupported geometry type: "+h.getType());return h};var ee=class extends Y{constructor(t){t=t||{},super({stroke:t.stroke,text:t.text,zIndex:t.zIndex,geometry:t.geometry}),this.setRenderer(this._render.bind(this)),this._visible=t.visible!==!1,typeof t.width=="function"?this._widthFn=t.width:this.setWidth(t.width),this.setWidth2(t.width2),typeof t.color=="function"?this._colorFn=t.color:this.setColor(t.color),this.setColor2(t.color2),this.setLineCap(t.lineCap),this.setArrow(t.arrow),this.setArrowSize(t.arrowSize),this.setArrowColor(t.arrowColor),this._offset=[0,0],this.setOffset(t.offset0,0),this.setOffset(t.offset1,1),this._noOverlap=t.noOverlap}setWidth(t){this._width=t||0}setWidth2(t){this._width2=t}getOffset(t){return this._offset[t]}setOffset(t,e){switch(t=Math.max(0,parseFloat(t)),e){case 0:{this._offset[0]=t;break}case 1:{this._offset[1]=t;break}}}setLineCap(t){this._lineCap=t==="round"?"round":"butt"}getWidth(t,e){if(this._widthFn)return this._widthFn(t,e);var i=typeof this._width2=="number"?this._width2:this._width;return this._width+(i-this._width)*e}setColor(t){try{this._color=Z(t)}catch{this._color=[0,0,0,1]}}setColor2(t){try{this._color2=Z(t)}catch{this._color2=null}}setArrowColor(t){try{this._acolor=B(t)}catch{this._acolor=null}}getColor(t,e){if(this._colorFn)return B(this._colorFn(t,e));var i=this._color,s=this._color2||this._color;return"rgba("+ +Math.round(i[0]+(s[0]-i[0])*e)+","+Math.round(i[1]+(s[1]-i[1])*e)+","+Math.round(i[2]+(s[2]-i[2])*e)+","+(i[3]+(s[3]-i[3])*e)+")"}getArrow(){return this._arrow}setArrow(t){this._arrow=parseInt(t),(this._arrow<-1||this._arrow>2)&&(this._arrow=0)}getArrowSize(){return this._arrowSize||[16,16]}setArrowSize(t){Array.isArray(t)?this._arrowSize=t:typeof t=="number"&&(this._arrowSize=[t,t])}drawArrow(t,e,i,s,r){var n=this.getArrowSize()[0]*r,o=F(e,i),a=(e[0]-i[0])/o,l=(e[1]-i[1])/o;s=Math.max(this.getArrowSize()[1]/2,s/2)*r,t.beginPath(),t.moveTo(e[0],e[1]),t.lineTo(e[0]-n*a+s*l,e[1]-n*l-s*a),t.lineTo(e[0]-n*a-s*l,e[1]-n*l+s*a),t.lineTo(e[0],e[1]),t.fill()}_render(t,e){if(e.geometry.getType()==="LineString"){var i,s,r,n=e.context;if(!this._visible){var o=e.pixelRatio/e.resolution,a=Math.cos(e.rotation),l=Math.sin(e.rotation);s=e.geometry.getCoordinates();var u=t[0][0]-s[0][0]*o*a-s[0][1]*o*l,d=t[0][1]-s[0][0]*o*l+s[0][1]*o*a;for(t=[],i=0;r=s[i];i++)t[i]=[u+r[0]*o*a+r[1]*o*l,d+r[0]*o*l-r[1]*o*a,r[2]]}var g=this.getArrowSize()[0]*e.pixelRatio;n.save(),this.getOffset(0)&&this._splitAsize(t,this.getOffset(0)*e.pixelRatio),this.getOffset(1)&&this._splitAsize(t,this.getOffset(1)*e.pixelRatio,!0),t.length>1&&(this.getArrow()===-1||this.getArrow()===2)&&(r=this._splitAsize(t,g),this._acolor?n.fillStyle=this._acolor:n.fillStyle=this.getColor(e.feature,0),this.drawArrow(n,r[0],r[1],this.getWidth(e.feature,0),e.pixelRatio)),t.length>1&&this.getArrow()>0&&(r=this._splitAsize(t,g,!0),this._acolor?n.fillStyle=this._acolor:n.fillStyle=this.getColor(e.feature,1),this.drawArrow(n,r[0],r[1],this.getWidth(e.feature,1),e.pixelRatio));var C=this._splitInto(t,255,2),y=0,p=C.length;if(n.lineJoin="round",n.lineCap=this._lineCap||"butt",C.length>1)for(y=0;y<C.length;y++){var f=y/p;for(s=C[y],n.lineWidth=this.getWidth(e.feature,f)*e.pixelRatio,n.strokeStyle=this.getColor(e.feature,f),n.beginPath(),n.moveTo(s[0][0],s[0][1]),i=1;r=s[i];i++)n.lineTo(r[0],r[1]);n.stroke()}n.restore()}}_splitAsize(t,e,i){var s,r,n,o,a=0;for(i?n=t.pop():n=t.shift(),s=n;t.length;){if(i?r=t.pop():r=t.shift(),o=F(s,r),a+o>e){s=[s[0]+(r[0]-s[0])*(e-a)/o,s[1]+(r[1]-s[1])*(e-a)/o],o=F(s,n),i?(t.push(r),t.push(s),t.push([s[0]+(n[0]-s[0])/o,s[1]+(n[1]-s[1])/o])):(t.unshift(r),t.unshift(s),t.unshift([s[0]+(n[0]-s[0])/o,s[1]+(n[1]-s[1])/o]));break}a+=o,s=r}return[n,s]}_splitInto(t,e,i){var s,r,n=this._noOverlap?1:.9,o=[],a,l=0;for(s=1;r=t[s];s++)l+=F(t[s-1],r);var u=Math.max(i||2,l/(e||255)),d=t[0];l=0;var g=[d];for(s=1,r=t[1];s<t.length;){var C=r[0]-d[0],y=r[1]-d[1];if(a=Math.sqrt(C*C+y*y),l+a>u){var p=(u-l)/a;g.push([d[0]+C*p,d[1]+y*p]),o.push(g),d=[d[0]+C*p*n,d[1]+y*p*n],g=[d],l=0}else l+=a,d=r,g.push(d),s++,r=t[s]}return o.push(g),o}};const se={class:"relative w-screen h-screen flex flex-col"},ie=at({__name:"RoadMap",setup(h){const t=_t(),{travelPlansFromToday:e}=lt(t);$(()=>e.value.length,(f,c)=>{console.log("旅行计划列表长度变化",c,"->",f),u()});const i=ht(()=>e.value.map(f=>JSON.stringify(f.location)));$(i,(f,c)=>{f.forEach((_,w)=>{_!==c[w]&&(console.log(`计划 ${e.value[w].id} 的location发生变化`),u())})});const s=j(null);let r=null,n=null,o=null,a=null;const l=j([]),u=()=>{e.value||(l.value=[]),l.value=yt.cloneDeep(e.value).sort((f,c)=>f.startDateTime-c.startDateTime)};u();const d=f=>{const c=new Date(f),_=c.getDate(),w=c.getMonth(),v=c.getFullYear();return[(_+w*31+v*365)%360,70,50,1]},g=f=>{const c=new Date(f);return`${c.getFullYear()}-${(c.getMonth()+1).toString().padStart(2,"0")}-${c.getDate().toString().padStart(2,"0")} ${c.getHours().toString().padStart(2,"0")}:${c.getMinutes().toString().padStart(2,"0")}`},C=async()=>{s.value&&(r=new Gt({target:s.value,layers:[new G({source:new U({url:await Qt(),maxZoom:17})}),new G({source:new U({url:await te(),maxZoom:17})})],view:new Ut({center:x([116.404,39.915]),zoom:10})}),a=new K({source:new Q}),r.addLayer(a),n=new ee({width:3,color:"rgba(0, 0, 255, 0.7)",lineCap:"round"}),o=new K({source:new Q,style:n}),r.addLayer(o),y())},y=()=>{if(!r||!a||!o)return;const f=a.getSource(),c=o.getSource();if(!f||!c||(f.clear(),c.clear(),l.value.length===0))return;const _=[],w=[];if(l.value.forEach((v,E)=>{const R=[v.location.coordinates.lng,v.location.coordinates.lat];_.push(R);const I=new q(x(R)),P=new tt({geometry:I,name:v.title,time:g(v.startDateTime),index:E}),k=d(v.startDateTime),W=`hsl(${k[0]}, ${k[1]}%, ${k[2]}%)`;P.setStyle(new Y({image:new J({radius:8,fill:new L({color:W}),stroke:new z({color:"white",width:2})}),text:new H({text:`${E+1}`,fill:new L({color:"white"}),scale:1.2})}));const ot=new Y({image:new J({radius:10,fill:new L({color:W}),stroke:new z({color:"white",width:3})}),text:new H({text:`${v.title}
${g(v.startDateTime)}`,fill:new L({color:"black"}),backgroundFill:new L({color:"rgba(255,255,255,0.7)"}),padding:[5,5,5,5],offsetY:-25,textAlign:"center"})});P.set("normalStyle",P.getStyle()),P.set("hoverStyle",ot),w.push(P)}),f.addFeatures(w),_.length>1){const v=_.map(I=>x(I)),E=new A(v),R=new tt({geometry:E});R.setStyle(new Y({stroke:new z({color:"rgba(0, 0, 255, 0.5)",width:3})})),c.addFeature(R)}if(w.length>0){const v=f.getExtent();v&&!isNaN(v[0])&&r.getView().fit(v,{padding:[50,50,50,50],duration:1e3})}},p=()=>{if(!r||!a)return;let f=null;r.on("pointermove",c=>{if(!a)return;const _=r==null?void 0:r.forEachFeatureAtPixel(c.pixel,w=>w);f&&(f.setStyle(f.get("normalStyle")),f=null),_&&(f=_,_.setStyle(_.get("hoverStyle"))),r&&(r.getTargetElement().style.cursor=_?"pointer":"")})};return $(l,()=>{y()},{deep:!0}),dt(async()=>{await C(),p()}),(f,c)=>{const _=vt;return gt(),ft("div",se,[ut(_,{title:"路线图","left-arrow":"",onClickLeft:c[0]||(c[0]=w=>f.$router.back())}),ct("div",{ref_key:"mapContainer",ref:s,class:"travel-map"},null,512)])}}}),de=Ct(ie,[["__scopeId","data-v-614c1191"]]);export{de as default};
