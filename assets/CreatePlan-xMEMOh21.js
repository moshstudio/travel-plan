import{d as b,ae as y,y as C,L as S,ag as V,a as n,ai as p,am as c,ah as k,au as r,ap as A,af as T,aD as f,aq as P}from"./index-CpL1zRha.js";import{C as x,F as U,a as B}from"./index-BTvapICq.js";import{d as L,N}from"./index-s5J9asle.js";import{g as F,b as I}from"./tdt-B-KCefEB.js";import{T as R}from"./TravelPlan-k6Lqvmii.js";import{P as q,T as z}from"./TravelTagSelector-DbdAJ--R.js";import{D as H}from"./DateTimeRangePicker-DYlZbOqk.js";import{s as l,a as E}from"./function-call-bTWHa3iy.js";import{B as G}from"./mount-component-COyTfLeg.js";import"./index-CvqAlFEX.js";import"./format-BUPkFkKG.js";const O={class:"w-screen h-screen flex flex-col overflow-hidden bg-[var(--van-background)]"},Z={class:"flex-grow w-full h-full p-2 overflow-auto"},$={class:"p-4"},h=b({__name:"CreatePlan",setup(j){const o=L(),{currentTravel:i}=y(o),e=C({name:"",startDateTime:new Date(new Date().setHours(8,0,0,0)),endDateTime:new Date(new Date().setHours(8,0,0,0)),tags:[],isAllDay:!1,notes:"",priority:"medium"}),v=async()=>{if(!e.name||!e.startDateTime||!e.endDateTime){l("请填写必填信息");return}if(!o.planSelectAddress){l("请选择目的地");return}if(e.startDateTime>e.endDateTime){l("结束时间必须晚于开始时间");return}if(!i.value){l("请先创建旅行"),T.push({name:"CreateTravel"});return}const s={travelId:i.value.travelId,title:e.name,description:e.notes,startDateTime:e.startDateTime.getTime(),endDateTime:e.endDateTime.getTime(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,status:R.planned,priority:e.priority,tags:f(e.tags),location:f(o.planSelectAddress),version:1,createdAt:Date.now(),updatedAt:Date.now()};console.log(s),await o.addTravelPlan(s),E("计划创建成功"),o.planSelectAddress=void 0,m()},m=()=>{T.push({name:"Travel"})};return S(async()=>{if(!o.planSelectAddress){const s=await F();if(s){const t=await I(s);o.planSelectAddress={name:t,coordinates:{lng:s.lng,lat:s.lat}}}}}),(s,t)=>{const g=N,d=U,D=B,w=x,_=G;return k(),V("div",O,[n(g,{title:"添加旅行计划","left-arrow":"",onClickLeft:m}),p("div",Z,[n(w,{inset:""},{default:c(()=>{var u;return[n(d,{modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.name=a),label:"计划名称",placeholder:"请输入计划名称",clearable:"",required:""},null,8,["modelValue"]),n(H,{"start-date-time":e.startDateTime,"onUpdate:startDateTime":t[1]||(t[1]=a=>e.startDateTime=a),"end-date-time":e.endDateTime,"onUpdate:endDateTime":t[2]||(t[2]=a=>e.endDateTime=a),"time-selectable":!0},null,8,["start-date-time","end-date-time"]),n(q,{modelValue:e.priority,"onUpdate:modelValue":t[3]||(t[3]=a=>e.priority=a)},null,8,["modelValue"]),n(z,{tags:e.tags,"custom-tags":r(o).customTravelPlanTags,"onUpdate:tags":t[4]||(t[4]=a=>e.tags=a),"onUpdate:customTags":t[5]||(t[5]=a=>r(o).updateCustomTravelPlanTags(a))},null,8,["tags","custom-tags"]),n(D,{title:"目的地",value:((u=r(o).planSelectAddress)==null?void 0:u.name)||"",clickable:"","is-link":"",onClick:t[6]||(t[6]=()=>s.$router.push({name:"PlanPosition"}))},null,8,["value"]),n(d,{modelValue:e.notes,"onUpdate:modelValue":t[7]||(t[7]=a=>e.notes=a),rows:"3",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注信息","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]}),_:1}),p("div",$,[n(_,{round:"",block:"",type:"primary",class:"bg-blue-500",onClick:v},{default:c(()=>t[8]||(t[8]=[A(" 创建计划 ")])),_:1,__:[8]})])])])}}}),se=P(h,[["__scopeId","data-v-bea45ea8"]]);export{se as default};
