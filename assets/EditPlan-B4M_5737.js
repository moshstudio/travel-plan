import{d as C,ae as B,r as S,y as U,L as A,ag as T,a as l,ad as N,ai as D,am as f,ah as g,au as w,ap as F,ay as R,af as d,aD as y,aq as h}from"./index-CZWEouzK.js";import{C as E,F as L,a as q}from"./index-j7wV6zNQ.js";import{a as z,N as H}from"./index-BO6MG9xY.js";import{T as G}from"./TravelPlan-k6Lqvmii.js";import{P as O,T as Z}from"./TravelTagSelector-BfulvawX.js";import{D as $}from"./DateTimeRangePicker-mGzCmiQ2.js";import{B as j}from"./index-CBaRPeI7.js";import{s as n,a as J}from"./function-call-9sgE79iv.js";import"./use-id-DkbEosCT.js";import"./index-BbvS-asm.js";import"./mount-component-BTx8yv52.js";import"./format-BUPkFkKG.js";const K={key:0,class:"w-screen h-screen flex flex-col items-center overflow-hidden bg-[var(--van-background)]"},M={key:1,class:"w-screen h-screen flex flex-col overflow-hidden bg-[var(--van-background)]"},Q={class:"flex-grow w-full h-full p-2 overflow-auto"},W={class:"p-4"},X=C({__name:"EditPlan",props:{travelPlanId:String},setup(i){var c;const s=z();R();const{currentTravel:m}=B(s),t=S(),e=U({name:"",startDateTime:new Date(new Date().setHours(8,0,0,0)),endDateTime:new Date(new Date().setHours(8,0,0,0)),tags:[],isAllDay:!1,notes:"",priority:"medium",location:(c=t.value)==null?void 0:c.location}),P=async()=>{if(i.travelPlanId){if(t.value=s.getTravelPlanById(i.travelPlanId),!t.value){n("计划不存在"),d.back();return}e.name=t.value.title,e.startDateTime=new Date(t.value.startDateTime),e.endDateTime=new Date(t.value.endDateTime),e.tags=t.value.tags||[],e.priority=t.value.priority,e.isAllDay=t.value.isAllDay||!1,e.notes=t.value.description||"",e.location=t.value.location}},_=async()=>{if(!(e!=null&&e.name)||!(e!=null&&e.startDateTime)||!(e!=null&&e.endDateTime)){n("请填写必填信息");return}if(!e.location){n("请选择目的地");return}if(e.startDateTime>e.endDateTime){n("结束时间必须晚于开始时间");return}if(!m.value){n("请先创建旅行"),d.push({name:"CreateTravel"});return}if(!t.value){n("计划不存在");return}const r={id:t.value.id,travelPlanId:t.value.travelPlanId,travelId:m.value.travelId,title:e.name,description:e.notes,startDateTime:e.startDateTime.getTime(),endDateTime:e.endDateTime.getTime(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,status:G.planned,priority:e.priority,tags:y(e.tags),location:y(e.location),version:1,createdAt:Date.now(),updatedAt:Date.now()};console.log(r);try{await s.updateTravelPlan(r),J("计划更新成功"),u()}catch(a){n("更新计划失败"),console.error(a)}},u=()=>{d.back()};return A(async()=>{await P()}),(r,a)=>{const b=N,k=H,v=L,I=q,V=E,x=j;return t.value?(g(),T("div",M,[l(k,{title:"编辑旅行计划","left-arrow":"",onClickLeft:u}),D("div",Q,[l(V,{inset:""},{default:f(()=>{var p;return[l(v,{modelValue:e.name,"onUpdate:modelValue":a[0]||(a[0]=o=>e.name=o),label:"计划名称",placeholder:"请输入计划名称",clearable:"",required:""},null,8,["modelValue"]),l($,{"start-date-time":e.startDateTime,"onUpdate:startDateTime":a[1]||(a[1]=o=>e.startDateTime=o),"end-date-time":e.endDateTime,"onUpdate:endDateTime":a[2]||(a[2]=o=>e.endDateTime=o),"time-selectable":!0},null,8,["start-date-time","end-date-time"]),l(O,{modelValue:e.priority,"onUpdate:modelValue":a[3]||(a[3]=o=>e.priority=o)},null,8,["modelValue"]),l(Z,{tags:e.tags,"custom-tags":w(s).customTravelPlanTags,"onUpdate:tags":a[4]||(a[4]=o=>e.tags=o),"onUpdate:customTags":a[5]||(a[5]=o=>w(s).updateCustomTravelPlanTags(o))},null,8,["tags","custom-tags"]),l(I,{title:"目的地",value:((p=e.location)==null?void 0:p.name)||"",clickable:"","is-link":"",onClick:a[6]||(a[6]=()=>r.$router.push({name:"PlanPosition",params:{travelPlanId:i.travelPlanId}}))},null,8,["value"]),l(v,{modelValue:e.notes,"onUpdate:modelValue":a[7]||(a[7]=o=>e.notes=o),rows:"3",autosize:"",label:"备注",type:"textarea",placeholder:"请输入备注信息","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]}),_:1}),D("div",W,[l(x,{round:"",block:"",type:"primary",class:"bg-blue-500",onClick:_},{default:f(()=>a[8]||(a[8]=[F(" 更新计划 ")])),_:1,__:[8]})])])])):(g(),T("div",K,[l(b)]))}}}),ue=h(X,[["__scopeId","data-v-335600df"]]);export{ue as default};
