import{d as j,r as t,f as G,aD as R,L as Y,ag as h,a as y,ai as V,am as k,aj as C,au as $,ah as i,aw as x,an as q,ao as F,ay as H,af as J,aE as K,aq as Q}from"./index-CpL1zRha.js";import{C as W,a as ee}from"./index-BTvapICq.js";import{S as ae,M as oe}from"./LocaltionControl-D5KttAdV.js";import{d as te,_ as ne,N as le,I as se}from"./index-s5J9asle.js";import{V as A,f as L,a as re,M as ce,Z as ie,T as b,X as B,t as I}from"./XYZ-CZPLbATp.js";import{c as ue,g as ve,b as P,t as de,a as me}from"./tdt-B-KCefEB.js";const pe={class:"relative w-screen h-screen flex flex-col"},fe={class:"relative"},we={key:0,class:"absolute top-[50px] left-0 right-0 w-full max-h-[260px] overflow-auto z-1001 thin-scrollbar"},_e=j({__name:"PlanPositionSelect",setup(ge){const w=t(),n=t(),d=te(),S=H(),l=t(""),m=t(),c=t(),_=t(),s=t(),u=t([]),p=t(!1),f=G({get(){return n.value?n.value.location:d.planSelectAddress},set(e){e&&(n.value?(n.value.location=e,d.updateTravelPlan(R(n.value))):d.planSelectAddress=e)}}),Z=async()=>{S.params.travelPlanId?(w.value=S.params.travelPlanId,n.value=d.getTravelPlanById(w.value)):(w.value=void 0,n.value=void 0),K(f)},E=()=>{setTimeout(()=>{p.value=!1},200)};async function N(){c.value=new re({color:"#369",contentColor:"#000",onshow:function(e){}}),_.value=new oe,m.value=new ce({target:"mapDiv",layers:[new b({source:new B({url:await de(),maxZoom:17})}),new b({source:new B({url:await me(),maxZoom:17})})],view:new A({center:L([116.3976,39.9035]),zoom:14,projection:"EPSG:3857"}),overlays:[c.value],controls:[_.value,new ie]}),_.value.on("position",async function(e){var a;if(e.coordinate){const o=I(e.coordinate),r=await P({lng:o[0],lat:o[1]});(a=c.value)==null||a.hide(),l.value=r,s.value={name:r,coordinates:{lng:o[0],lat:o[1]}}}}),m.value.on("click",async function(e){var r;(r=c.value)==null||r.show(e.coordinate);const a=I(e.coordinate),o=await P({lng:a[0],lat:a[1]});l.value=o,s.value={name:o,coordinates:{lng:a[0],lat:a[1]}}})}const O=ne.debounce(async e=>{e&&(u.value=[],u.value=await ue(e),p.value=!0)},800);function g(e){var a,o;l.value=e.name,s.value=e,(a=m.value)==null||a.setView(new A({center:L([e.coordinates.lng,e.coordinates.lat]),zoom:14,projection:"EPSG:3857"})),(o=c.value)==null||o.show(L([e.coordinates.lng,e.coordinates.lat])),u.value=[],p.value=!1}function T(){console.log("确定位置",s.value),f.value=s.value,J.back()}function z(){var e;l.value="",s.value=void 0,(e=c.value)==null||e.hide(),u.value=[]}return Y(async()=>{if(m.value||await N(),await Z(),f.value)g(f.value);else{const e=await ve();if(e){const a=await P(e);g({name:a,coordinates:{lng:e.lng,lat:e.lat}})}}}),(e,a)=>{const o=se,r=le,D=ae,M=ee,U=W;return i(),h("div",pe,[y(r,{title:"选择位置","left-arrow":"",onClickLeft:a[0]||(a[0]=v=>e.$router.back())},{right:k(()=>[s.value?(i(),x(o,{key:0,name:"success",size:"18",onClick:T})):C("",!0)]),_:1}),V("div",fe,[y(D,{modelValue:l.value,"onUpdate:modelValue":[a[1]||(a[1]=v=>l.value=v),$(O)],placeholder:"请输入搜索关键词",shape:"round",class:"h-[50px]",clearable:!1,onBlur:E},{"right-icon":k(()=>[l.value?(i(),x(o,{key:0,name:"cross",onClick:z})):C("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"]),p.value?(i(),h("div",we,[y(U,{class:"px-4"},{default:k(()=>[(i(!0),h(q,null,F(u.value,(v,X)=>(i(),x(M,{key:X,title:v.name,onClick:he=>g(v),clickable:""},null,8,["title","onClick"]))),128))]),_:1})])):C("",!0)]),a[2]||(a[2]=V("div",{id:"mapDiv",class:"w-full h-full"},null,-1))])}}}),Se=Q(_e,[["__scopeId","data-v-22d8685c"]]);export{Se as default};
