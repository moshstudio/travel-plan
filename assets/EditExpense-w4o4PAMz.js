import{d as j,ae as G,r as p,ay as Y,y as H,L as J,ag as f,a as o,aw as K,ad as Q,ai as g,am as s,ah as c,au as w,an as D,ao as E,aN as W,al as X,ar as Z,ap as C,aC as ee,ak as B,aD as h,aq as ae}from"./index-CpL1zRha.js";import{C as te}from"./index-CI1npSWs.js";import{C as oe,F as ne,a as le}from"./index-BTvapICq.js";import{d as se,N as re}from"./index-s5J9asle.js";import{I as ie,C as ue}from"./iconify-DboF3RXc.js";import{B as de,P as pe}from"./mount-component-COyTfLeg.js";import{s as m,a as ce}from"./function-call-bTWHa3iy.js";const me={class:"w-screen h-screen flex flex-col bg-[var(--van-background)]"},ve={key:1,class:"flex-grow w-full p-4 overflow-auto"},fe={class:"p-2 flex flex-wrap gap-2"},ye={class:"mt-6 p-2"},xe=j({__name:"EditExpense",setup(_e){var S;const y=se(),T=Y(),i=Z(),{currentTravel:x}=G(y),u=p(T.params.expenseId),l=p(),I=p(!0),e=H({amount:0,currency:"CNY",description:"",dateTime:new Date().toISOString(),paymentMethod:"alipay",tags:[],location:(S=l.value)==null?void 0:S.location}),v=p(!1),N=[1,2,5,8,10,20,50,100],V=[{text:"支付宝",value:"alipay"},{text:"微信支付",value:"wechat_pay"},{text:"现金",value:"cash"},{text:"信用卡",value:"credit_card"},{text:"银行转账",value:"bank_transfer"},{text:"其他",value:"other"}],d=p(!1),P=async()=>{if(u.value=T.params.expenseId,!(!u.value||!x.value))try{l.value=await y.getTravelExpenseById(u.value),l.value&&(e.amount=l.value.amount,e.currency=l.value.currency,e.description=l.value.description||"",e.dateTime=new Date(l.value.dateTime).toISOString(),e.paymentMethod=l.value.paymentMethod,e.tags=[...l.value.tags||[]],e.location=l.value.location)}catch(r){m("加载花费数据失败"),console.error(r)}finally{I.value=!1}},U=async()=>{if(!e.amount){m("请输入有效金额");return}if(!x.value){m("旅行数据不存在"),i.push({name:"Travel"});return}if(!l.value){m("花费数据不存在"),i.push({name:"Travel"});return}try{const r=new Date,a={id:l.value.id,travelId:x.value.travelId,expenseId:u.value,amount:Number(e.amount),currency:e.currency,description:e.description,dateTime:new Date(e.dateTime).getTime(),paymentMethod:e.paymentMethod,tags:h(e.tags),isReimbursed:!1,location:h(e.location),createdAt:r.toISOString(),updatedAt:r.toISOString()};await y.updateTravelExpense(h(a)),ce("花费记录更新成功"),i.push({name:"Travel"})}catch(r){m("更新花费记录失败"),console.error(r)}},L=()=>{i.push({name:"Travel"})},O=["餐饮","交通","住宿","门票","购物","娱乐","其他"];return J(async()=>{await P()}),(r,a)=>{const R=re,q=Q,_=ne,M=de,k=oe,b=le,A=te,F=ue,$=ee,z=pe;return c(),f("div",me,[o(R,{title:"编辑花费记录","left-arrow":"",onClickLeft:L}),I.value?(c(),K(q,{key:0,class:"flex-grow flex items-center justify-center"})):(c(),f("div",ve,[o(k,{inset:"",class:"mb-4"},{default:s(()=>[o(_,{"model-value":e.amount,"onUpdate:modelValue":a[0]||(a[0]=t=>e.amount=t),label:"金额",type:"number",placeholder:"0.00",required:"",clearable:"",class:"text-2xl font-bold"},{"right-icon":s(()=>[o(w(ie),{icon:"mingcute:currency-cny-2-fill",width:"18",height:"18"})]),_:1},8,["model-value"]),g("div",fe,[(c(),f(D,null,E(N,t=>o(M,{key:t,size:"small",plain:"",type:"primary",onClick:n=>e.amount=t},{default:s(()=>[C(B(t),1)]),_:2},1032,["onClick"])),64))])]),_:1}),o(k,{inset:"",class:"mb-4"},{default:s(()=>{var t;return[o(b,{center:"","is-link":"",title:"支付方式",value:(t=V.find(n=>n.value===e.paymentMethod))==null?void 0:t.text,onClick:a[1]||(a[1]=n=>d.value=!0)},null,8,["value"]),o(b,{center:"","is-link":"",title:"时间",onClick:a[5]||(a[5]=n=>v.value=!v.value),class:"datetime-cell"},{value:s(()=>[g("div",{onClick:a[4]||(a[4]=X(()=>{},["stop"])),class:"flex items-center justify-end"},[o(w(W),{modelValue:e.dateTime,"onUpdate:modelValue":a[2]||(a[2]=n=>e.dateTime=n),"is-open":v.value,"onUpdate:isOpen":a[3]||(a[3]=n=>v.value=n),type:"datetime",class:"max-w-[160px]"},null,8,["modelValue","is-open"])])]),_:1})]}),_:1}),o(k,{inset:"",class:"mb-4"},{default:s(()=>{var t;return[o(b,{title:"位置",value:((t=e.location)==null?void 0:t.name)||"未设置位置",clickable:"","is-link":"",onClick:a[6]||(a[6]=()=>w(i).push({name:"ExpensePosition",params:{expenseId:u.value}}))},null,8,["value"]),o(_,{modelValue:e.description,"onUpdate:modelValue":a[7]||(a[7]=n=>e.description=n),label:"描述",placeholder:"可选：输入消费描述",clearable:""},null,8,["modelValue"]),o(_,{name:"tags",label:"分类"},{input:s(()=>[o(F,{modelValue:e.tags,"onUpdate:modelValue":a[8]||(a[8]=n=>e.tags=n),direction:"horizontal"},{default:s(()=>[(c(),f(D,null,E(O,n=>o(A,{key:n,name:n,shape:"square",class:"mr-2 mb-2"},{default:s(()=>[C(B(n),1)]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"])]),_:1})]}),_:1}),g("div",ye,[o(M,{round:"",block:"",type:"primary",size:"large",onClick:U,disabled:!e.amount},{default:s(()=>a[13]||(a[13]=[C(" 更新花费记录 ")])),_:1,__:[13]},8,["disabled"])])])),o(z,{show:d.value,"onUpdate:show":a[12]||(a[12]=t=>d.value=t),position:"bottom",round:""},{default:s(()=>[o($,{value:e.paymentMethod,"onUpdate:value":a[9]||(a[9]=t=>e.paymentMethod=t),columns:V,onConfirm:a[10]||(a[10]=t=>{e.paymentMethod=t.selectedValues[0],d.value=!1}),onCancel:a[11]||(a[11]=t=>d.value=!1)},null,8,["value"])]),_:1},8,["show"])])}}}),Ie=ae(xe,[["__scopeId","data-v-20dbe71e"]]);export{Ie as default};
