var V=Object.defineProperty;var A=(n,o,e)=>o in n?V(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var c=(n,o,e)=>A(n,typeof o!="symbol"?o+"":o,e);import{F as R,f as k}from"./index-j7wV6zNQ.js";import{a as B}from"./use-id-DkbEosCT.js";import{d as G,e as b,c as K,r as N,g as W,a as l,a1 as g,a0 as D,t as T,q as _,N as j,w as O}from"./index-CZWEouzK.js";import{C as q,S as z,b as H,c as U,F as Z,f as $,P as J,B as f,u as Q}from"./XYZ-s-mLm_Ec.js";import{V as X,a as Y,F as ee}from"./Vector-CMMYpUJZ.js";const[te,d,ae]=K("search"),oe=b({},k,{label:String,shape:_("square"),leftIcon:_("search"),clearable:T,actionText:String,background:String,showAction:Boolean});var ne=G({name:te,props:oe,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(n,{emit:o,slots:e,attrs:a}){const r=B(),i=N(),s=()=>{e.action||(o("update:modelValue",""),o("cancel"))},u=t=>{t.keyCode===13&&(j(t),o("search",n.modelValue))},h=()=>n.id||`${r}-input`,y=()=>{if(e.label||n.label)return l("label",{class:d("label"),for:h(),"data-allow-mismatch":"attribute"},[e.label?e.label():n.label])},p=()=>{if(n.showAction){const t=n.actionText||ae("cancel");return l("div",{class:d("action"),role:"button",tabindex:0,onClick:s},[e.action?e.action():t])}},v=()=>{var t;return(t=i.value)==null?void 0:t.blur()},L=()=>{var t;return(t=i.value)==null?void 0:t.focus()},w=t=>o("blur",t),I=t=>o("focus",t),C=t=>o("clear",t),F=t=>o("clickInput",t),S=t=>o("clickLeftIcon",t),x=t=>o("clickRightIcon",t),E=Object.keys(k),M=()=>{const t=b({},a,g(n,E),{id:h()}),m=P=>o("update:modelValue",P);return l(R,D({ref:i,type:"search",class:d("field",{"with-message":t.errorMessage}),border:!1,onBlur:w,onFocus:I,onClear:C,onKeypress:u,onClickInput:F,onClickLeftIcon:S,onClickRightIcon:x,"onUpdate:modelValue":m},t),g(e,["left-icon","right-icon"]))};return W({focus:L,blur:v}),()=>{var t;return l("div",{class:d({"show-action":n.showAction}),style:{background:n.background}},[(t=e.left)==null?void 0:t.call(e),l("div",{class:d("content",n.shape)},[y(),M()]),p()])}}});const ue=O(ne);class he extends q{constructor(e){e=e||{};const a=document.createElement("button");a.type="button",a.title=e.tipLabel||"定位到当前位置",a.innerHTML=`<svg viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <circle cx="12" cy="12" r="10"></circle>
  <circle cx="12" cy="12" r="4"></circle>
</svg>`,a.style="display: flex; align-items: center; justify-content: center; ";const r=document.createElement("div");r.className=e.className||"ol-unselectable ol-control",r.style="right: 10px; bottom: 10px;",r.appendChild(a);super({element:r,target:e.target});c(this,"button_");c(this,"listenerKeys_",[]);c(this,"geolocationWatchId_",null);c(this,"markerLayer_",null);c(this,"markerFeature_",null);this.button_=a,this.markerLayer_=new X({source:new Y,style:e.markerStyle||this.getDefaultMarkerStyle_(),zIndex:1e3}),this.button_.addEventListener("click",this.handleClick_.bind(this),!1),e.autoActivate&&this.activate_()}getDefaultMarkerStyle_(){return new z({image:new H({radius:6,fill:new Z({color:"#4285F4"}),stroke:new U({color:"#FFB6C140",width:36})})})}handleClick_(){this.activate_()}activate_(){const e=this.getMap();if(!e){console.warn("Location control must be added to a map before activation");return}this.markerLayer_&&!e.getAllLayers().includes(this.markerLayer_)&&e.addLayer(this.markerLayer_),this.button_.disabled=!0,this.button_.classList.add("ol-locating"),this.deactivate_(),"geolocation"in navigator?this.geolocationWatchId_=navigator.geolocation.watchPosition(this.handleGeolocationSuccess_.bind(this),this.handleGeolocationError_.bind(this),{enableHighAccuracy:!0,maximumAge:3e4,timeout:1e4}):this.handleGeolocationError_({code:2,message:"Geolocation not supported by this browser"})}deactivate_(){this.geolocationWatchId_!==null&&(navigator.geolocation&&navigator.geolocation.clearWatch(this.geolocationWatchId_),this.geolocationWatchId_=null),this.button_.disabled=!1,this.button_.classList.remove("ol-locating")}handleGeolocationSuccess_(e){var u;const a=this.getMap();if(!a||!this.markerLayer_)return;const r=[e.coords.longitude,e.coords.latitude],i=$(r);this.markerFeature_?this.markerFeature_.getGeometry().setCoordinates(i):(this.markerFeature_=new ee({geometry:new J(i)}),(u=this.markerLayer_.getSource())==null||u.addFeature(this.markerFeature_));const s=new f("position");s.type="position",s.coordinate=i,s.lnglat=r,this.dispatchEvent(s),a.getView().animate({center:i,zoom:Math.max(a.getView().getZoom()||14,14)}),this.deactivate_()}handleGeolocationError_(e){console.error("Geolocation error:",e.message);const a=new f("error");a.type="error",a.error=e,this.dispatchEvent(a),this.deactivate_()}setMap(e){for(let a=0,r=this.listenerKeys_.length;a<r;++a)Q(this.listenerKeys_[a]);this.listenerKeys_.length=0,super.setMap(e),e&&this.markerLayer_&&(e.addLayer(this.markerLayer_),this.listenerKeys_.push(e.on("postrender",this.handleMapPostRender_.bind(this))))}handleMapPostRender_(e){}disposeInternal(){this.deactivate_(),this.button_.removeEventListener("click",this.handleClick_.bind(this),!1);const e=this.getMap();e&&this.markerLayer_&&(e.removeLayer(this.markerLayer_),this.markerLayer_=null),super.disposeInternal()}}export{he as M,ue as S};
