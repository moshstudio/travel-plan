import{d as X,r as n,f as G,aD as R,L as Y,ag as k,a as C,ai as S,am as V,aj as L,au as $,ah as u,aw as b,an as F,ao as q,ay as H,af as J,aE as K,aq as Q}from"./index-d8_m604x.js";import{C as W,a as ee}from"./index-BK36Oy50.js";import{S as ae,M as oe}from"./LocaltionControl-CnY7EVLH.js";import{a as te,_ as ne,N as le,I as se}from"./index-C3vBwbN3.js";/* empty css               */import{t as A,V as P,f as E,a as re,M as ce,Z as ie,T as Z,X as z}from"./XYZ-lN7jL1I7.js";import{d as ue,g as de,b as B,t as ve,a as pe}from"./tdt-CGZYR8xf.js";import"./use-id-FzMcmI8R.js";import"./Vector-hE7sZCpc.js";const me={class:"relative w-screen h-screen flex flex-col"},fe={class:"relative"},ge={key:0,class:"absolute top-[50px] left-0 right-0 w-full max-h-[260px] overflow-auto z-1001 thin-scrollbar"},we=X({__name:"ExpensePositionSelect",setup(_e){const _=n(),l=n(),d=te(),I=H(),s=n(""),r=n(),c=n(),x=n(),i=n(),v=n([]),m=n(!1),f=G({get(){return l.value?(console.log(1,l.value.location),l.value.location):(console.log(2,d.expenseSelectAddress),d.expenseSelectAddress)},set(e){e&&(l.value?(l.value.location=e,d.updateTravelExpense(R(l.value))):d.expenseSelectAddress=e)}}),N=async()=>{I.params.expenseId?(_.value=I.params.expenseId,l.value=d.getTravelExpenseById(_.value)):(_.value=void 0,l.value=void 0),K(f)},O=()=>{setTimeout(()=>{m.value=!1},200)};async function T(){c.value=new re({color:"#369",contentColor:"#000",onshow:function(e){}}),x.value=new oe,r.value=new ce({target:"mapDiv",layers:[new Z({source:new z({url:await ve(),maxZoom:17})}),new Z({source:new z({url:await pe(),maxZoom:17})})],view:new P({center:E([116.3976,39.9035]),zoom:14,projection:"EPSG:3857"}),overlays:[c.value],controls:[x.value,new ie]}),x.value.on("position",async function(e){var a;if(e.coordinate){const o=A(e.coordinate),t=await B({lng:o[0],lat:o[1]});(a=c.value)==null||a.hide(),s.value=t,i.value={name:t,coordinates:{lng:o[0],lat:o[1]}}}}),r.value.on("click",async function(e){var t;(t=c.value)==null||t.show(e.coordinate);const a=A(e.coordinate),o=await B({lng:a[0],lat:a[1]});s.value=o,i.value={name:o,coordinates:{lng:a[0],lat:a[1]}}})}const j=ne.debounce(async e=>{var g,w;if(!e)return;v.value=[];const a=(g=r.value)==null?void 0:g.getView();a==null||a.calculateExtent((w=r.value)==null?void 0:w.getSize());const o=a==null?void 0:a.getCenter(),t=o?A(o).map(y=>y.toFixed(5)).join(","):"0,0";v.value=await ue(e,"10000",t),m.value=!0},800);function h(e){var a,o;s.value=e.name,i.value=e,(a=r.value)==null||a.setView(new P({center:E([e.coordinates.lng,e.coordinates.lat]),zoom:14,projection:"EPSG:3857"})),(o=c.value)==null||o.show(E([e.coordinates.lng,e.coordinates.lat])),v.value=[],m.value=!1}function D(){f.value=i.value,J.back()}function M(){var e;s.value="",i.value=void 0,(e=c.value)==null||e.hide(),v.value=[]}return Y(async()=>{if(r.value||await T(),await N(),f.value)h(f.value);else{const e=await de();if(e){const a=await B(e);h({name:a,coordinates:{lng:e.lng,lat:e.lat}})}}}),(e,a)=>{const o=se,t=le,g=ae,w=ee,y=W;return u(),k("div",me,[C(t,{title:"选择位置","left-arrow":"",onClickLeft:a[0]||(a[0]=p=>e.$router.back())},{right:V(()=>[i.value?(u(),b(o,{key:0,name:"success",size:"18",onClick:D})):L("",!0)]),_:1}),S("div",fe,[C(g,{modelValue:s.value,"onUpdate:modelValue":[a[1]||(a[1]=p=>s.value=p),$(j)],placeholder:"请输入搜索关键词",shape:"round",class:"h-[50px]",clearable:!1,onBlur:O},{"right-icon":V(()=>[s.value?(u(),b(o,{key:0,name:"cross",onClick:M})):L("",!0)]),_:1},8,["modelValue","onUpdate:modelValue"]),m.value?(u(),k("div",ge,[a[2]||(a[2]=S("div",{class:"text-xs px-4 py-2 bg-[var(--van-background-2)]"}," 以下为当前显示中心位置附近的搜索结果 ",-1)),C(y,{class:"px-4"},{default:V(()=>[(u(!0),k(F,null,q(v.value,(p,U)=>(u(),b(w,{key:U,title:p.name,onClick:xe=>h(p),clickable:""},null,8,["title","onClick"]))),128))]),_:1})])):L("",!0)]),a[3]||(a[3]=S("div",{id:"mapDiv",class:"w-full h-full"},null,-1))])}}}),Ee=Q(we,[["__scopeId","data-v-5b84e7ad"]]);export{Ee as default};
